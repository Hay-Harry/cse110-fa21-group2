<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Test html</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>

  <body>
    <script type="text/javascript">
      //storage {
      //   categories: {cat1:[names],cat2:[names]}
      //   savedLists: {list1:[names],list2:[names]}
      //   recipeName1: json object
      //   recipeName2: json object
      // }

      // store recipe to local storage
      // add recipe name to category
      // input: category of api fetch, array of recipe json object
      function storeRecipeData(category, recipeArray) {
        try {
          // store recipe
          for (let i = 0; i < recipeArray.length; i++) {
            localStorage.setItem(
              recipeArray[i]["title"],
              JSON.stringify(recipeArray[i])
            );
          }

          let allRecipeName = recipeArray.map((recipe) => recipe["title"]);
          // add to category list
          let catData = JSON.parse(localStorage.getItem("categories"));
          if (catData == null) {
            catData = {};
            catData[category] = allRecipeName;
            localStorage.setItem("categories", JSON.stringify(catData));
          } else {
            if (category in catData) {
              for (let i = 0; i < allRecipeName.length; i++) {
                if (!catData[category].includes(allRecipeName[i])) {
                  catData[category].push(allRecipeName[i]);
                }
              }
            } else {
              catData[category] = allRecipeName;
            }
            localStorage.setItem("categories", JSON.stringify(catData));
          }
        } catch (e) {
          // storage might be full
          console.log(e);
        }
      }

      function saveRecipeToList(listName, recipeName) {
        try {
          let listData = JSON.parse(localStorage.getItem("savedLists"));
          if (listData == null) {
            listData = {};
            listData[listName] = [recipeName];
            localStorage.setItem("savedLists", JSON.stringify(listData));
          } else {
            if (listName in listData) {
              if (!listData[listName].includes(recipeName)) {
                listData[listName].push(recipeName);
                localStorage.setItem("savedLists", JSON.stringify(listData));
              }
            } else {
              listData[listName] = [recipeName];
              localStorage.setItem("savedLists", JSON.stringify(listData));
            }
          }
        } catch (e) {
          console.error(e);
        }
      }

      // remove recipe in a list (remove recipename from savedlist)
      // input: list name to store recipe to, edited recipeObject
      function removeRecipeFromList(listName, recipeName) {
        try {
          let listData = JSON.parse(localStorage.getItem("savedLists"));
          if (listData != null && listName in listData) {
            listData[listName] = listData[listName].filter(
              (name) => name != recipeName
            );
            localStorage.setItem("savedLists", JSON.stringify(listData));
          }
        } catch (e) {
          console.error(e);
        }
      }

      // if list already exist, do nothing. else create list in savedLists
      // input: list name to create.
      function createList(listName) {
        try {
          let listData = JSON.parse(localStorage.getItem("savedLists"));
          if (listData == null) {
            localStorage.setItem(
              "savedLists",
              JSON.stringify({ listName: [] })
            );
          } else {
            if (!(listName in listData)) {
              listData[listName] = [];
              localStorage.setItem("savedLists", JSON.stringify(listData));
            }
          }
        } catch (e) {
          console.error(e);
        }
      }

      // delete all the stored info of the list.
      // input: list name to delete.
      function deleteList(listName) {
        try {
          let listData = JSON.parse(localStorage.getItem("savedLists"));
          if (listData != null && listName in listData) {
            delete listData[listName];
            localStorage.setItem("savedLists", JSON.stringify(listData));
          }
        } catch (e) {
          console.error(e);
        }
      }

      // return recipe name in categories
      // input: none
      // output: {category1:[recipe names],category2:[recipe names]}
      function getCategoryRecipes() {
        return JSON.parse(localStorage.getItem("categories"));
      }

      // return recipe name in saved lists
      // input: none
      // output: {category1:[recipe names],category2:[recipe names]}
      function getSavedRecipes() {
        return JSON.parse(localStorage.getItem("savedLists"));
      }

      // return a specific json object from recipe name
      // input: recipeName
      // output: {category1:[recipe names],category2:[recipe names]}
      function getRecipe(recipeName) {
        return JSON.parse(localStorage.getItem(recipeName));
      }

      /*
      #TEST report#
      --------------------------------------------------------------------------------------------------------
      @function storeRecipeData(category, recipeArray) 
      when adding a recipe that has the same title as the recipe existed in the category, it create a recipe 
        with same title. This might be a desgin descion. 
      Potential risks: might cause problem/confusion when you want to search a recipe by title
      Test case location(search word): storeRecipeData duplicate Test: add existed recipes to existed Category
      --------------------------------------------------------------------------------------------------------
      @function saveRecipeToList(listName, recipeName) 
      no bug found. Just note that saveRecipeToList does not save a recipe that have the same title to list, 
        ie, it does not save duplicate(same title recipe) recipe
      Potential risks: non
      Test case location(search word): TEST saveRecipeToList & getSavedRecipes function
      --------------------------------------------------------------------------------------------------------
      @function removeRecipeFromList(listName, recipeName)
      no bug found
      Potential risks: non
      Test case location(search word): TEST removeRecipeFromList function
      --------------------------------------------------------------------------------------------------------
      @function createList(listName)
      no bug found
      Potential risks: non
      Test case location(search word): TEST createList & deleteList function
      --------------------------------------------------------------------------------------------------------
      @function deleteList(listName)
      no bug found
      Potential risks: non
      Test case location(search word): TEST createList & deleteList function
      --------------------------------------------------------------------------------------------------------
      @function getCategoryRecipes()
      no bug found
      Potential risks: non
      Test case location(search word): TEST storeRecipeData & getCategoryRecipes function
      --------------------------------------------------------------------------------------------------------
      @function getSavedRecipes()
      no bug found
      Potential risks: non
      Test case location(search word): TEST saveRecipeToList & getSavedRecipes function
      --------------------------------------------------------------------------------------------------------
      @function getRecipe(recipeName)
      When geting a recipe from a category that have duplicate(same title name) Recipes, it only return one of
      the recipe. 
      Potential risks: only return one of the recipe that the same title, you might not get what you want
      Test case location(search word): getRecip() duplicate test
      --------------------------------------------------------------------------------------------------------
      */

      //===TEST storeRecipeData & getCategoryRecipes function=================================================================================
      localStorage.clear();
      console.log();
      console.log("===TEST storeRecipeData & getCategoryRecipes function===");
      //storeRecipeData Test: new category with two new recipe-------------
      storeRecipeData("cat1", [
        { title: "cat1_recipe1" },
        { title: "cat1_recipe2" },
      ]);
      console.log("new category with new recipe:");
      console.log(getCategoryRecipes()); //Object { cat1: (2) […] }

      //storeRecipeData Test: additional new category with one new recipes-------------
      storeRecipeData("cat2", [{ title: "cat2_recipe1" }]);
      console.log("additional new category with one new recipes:");
      console.log(getCategoryRecipes()); //Object { cat1: (2) […], cat2: (1) […] }

      //storeRecipeData Test: add new recipes to existed Category-------------
      storeRecipeData("cat1", [
        { title: "cat1_recipe3" },
        { title: "cat1_recipe4" },
        { title: "cat1_recipe5" },
      ]);
      storeRecipeData("cat2", [
        { title: "cat2_recipe2" },
        { title: "cat2_recipe3" },
      ]);
      console.log("add new recipes to existed Category:");
      console.log(getCategoryRecipes()); //Object { cat1: (5) […], cat2: (3) […] }
    
    </script>
  </body>
</html>
