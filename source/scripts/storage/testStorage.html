<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Test html</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>

  <body>
    <script type="text/javascript">
      //storage {
      //   categories: {cat1:[names],cat2:[names]}
      //   savedLists: {list1:[names],list2:[names]}
      //   recipeName1: json object
      //   recipeName2: json object
      // }

      // store recipe to local storage
      // add recipe name to category
      // input: category of api fetch, array of recipe json object
      function storeRecipeData(category, recipeArray) {
        try {
          // store recipe
          for (let i = 0; i < recipeArray.length; i++) {
            localStorage.setItem(
              recipeArray[i]["title"],
              JSON.stringify(recipeArray[i])
            );
          }
          let allRecipeName = recipeArray.map((recipe) => recipe["title"]);
          // add to category list
          let catData = JSON.parse(localStorage.getItem("categories"));
          if (catData == null) {
            catData = {};
          }
          if (!(category in catData)) {
            catData[category] = [];
          }

          allRecipeName.forEach((Rname) => {
            if (!catData[category].includes(Rname)) {
              catData[category].push(Rname);
            }
          });
          localStorage.setItem("categories", JSON.stringify(catData));
        } catch (e) {
          // storage might be full
          console.log(e);
        }
      }

      function saveRecipeToList(listName, recipeName) {
        try {
          let listData = JSON.parse(localStorage.getItem("savedLists"));
          if (listData == null) {
            listData = {};
            listData[listName] = [recipeName];
            localStorage.setItem("savedLists", JSON.stringify(listData));
          } else {
            if (listName in listData) {
              if (!listData[listName].includes(recipeName)) {
                listData[listName].push(recipeName);
                localStorage.setItem("savedLists", JSON.stringify(listData));
              }
            } else {
              listData[listName] = [recipeName];
              localStorage.setItem("savedLists", JSON.stringify(listData));
            }
          }
        } catch (e) {
          console.error(e);
        }
      }

      // remove recipe in a list (remove recipename from savedlist)
      // input: list name to store recipe to, edited recipeObject
      function removeRecipeFromList(listName, recipeName) {
        try {
          let listData = JSON.parse(localStorage.getItem("savedLists"));
          if (listData != null && listName in listData) {
            listData[listName] = listData[listName].filter(
              (name) => name != recipeName
            );
            localStorage.setItem("savedLists", JSON.stringify(listData));
          }
        } catch (e) {
          console.error(e);
        }
      }

      // if list already exist, do nothing. else create list in savedLists
      // input: list name to create.
      function createList(listName) {
        try {
          let listData = JSON.parse(localStorage.getItem("savedLists"));
          if (listData == null) {
            localStorage.setItem(
              "savedLists",
              JSON.stringify({ listName: [] })
            );
          } else {
            if (!(listName in listData)) {
              listData[listName] = [];
              localStorage.setItem("savedLists", JSON.stringify(listData));
            }
          }
        } catch (e) {
          console.error(e);
        }
      }

      // delete all the stored info of the list.
      // input: list name to delete.
      function deleteList(listName) {
        try {
          let listData = JSON.parse(localStorage.getItem("savedLists"));
          if (listData != null && listName in listData) {
            delete listData[listName];
            localStorage.setItem("savedLists", JSON.stringify(listData));
          }
        } catch (e) {
          console.error(e);
        }
      }

      // return recipe name in categories
      // input: none
      // output: {category1:[recipe names],category2:[recipe names]}
      function getCategoryRecipes() {
        return JSON.parse(localStorage.getItem("categories"));
      }

      // return recipe name in saved lists
      // input: none
      // output: {category1:[recipe names],category2:[recipe names]}
      function getSavedRecipes() {
        return JSON.parse(localStorage.getItem("savedLists"));
      }

      // return a specific json object from recipe name
      // input: recipeName
      // output: {category1:[recipe names],category2:[recipe names]}
      function getRecipe(recipeName) {
        return JSON.parse(localStorage.getItem(recipeName));
      }

      /*
      #TEST report#
      --------------------------------------------------------------------------------------------------------
      @function storeRecipeData(category, recipeArray) 
      when adding a recipe that has the same title as the recipe existed in the category, it create a recipe 
        with same title. This might be a desgin descion. 
      Potential risks: might cause problem/confusion when you want to search a recipe by title
      Test case location(search word): storeRecipeData duplicate Test: add existed recipes to existed Category
      --------------------------------------------------------------------------------------------------------
      @function saveRecipeToList(listName, recipeName) 
      no bug found. Just note that saveRecipeToList does not save a recipe that have the same title to list, 
        ie, it does not save duplicate(same title recipe) recipe
      Potential risks: non
      Test case location(search word): TEST saveRecipeToList & getSavedRecipes function
      --------------------------------------------------------------------------------------------------------
      @function removeRecipeFromList(listName, recipeName)
      no bug found
      Potential risks: non
      Test case location(search word): TEST removeRecipeFromList function
      --------------------------------------------------------------------------------------------------------
      @function createList(listName)
      no bug found
      Potential risks: non
      Test case location(search word): TEST createList & deleteList function
      --------------------------------------------------------------------------------------------------------
      @function deleteList(listName)
      no bug found
      Potential risks: non
      Test case location(search word): TEST createList & deleteList function
      --------------------------------------------------------------------------------------------------------
      @function getCategoryRecipes()
      no bug found
      Potential risks: non
      Test case location(search word): TEST storeRecipeData & getCategoryRecipes function
      --------------------------------------------------------------------------------------------------------
      @function getSavedRecipes()
      no bug found
      Potential risks: non
      Test case location(search word): TEST saveRecipeToList & getSavedRecipes function
      --------------------------------------------------------------------------------------------------------
      @function getRecipe(recipeName)
      When geting a recipe from a category that have duplicate(same title name) Recipes, it only return one of
      the recipe. 
      Potential risks: only return one of the recipe that the same title, you might not get what you want
      Test case location(search word): getRecip() duplicate test
      --------------------------------------------------------------------------------------------------------
      */

      //===TEST storeRecipeData & getCategoryRecipes function=================================================================================
      localStorage.clear();
      console.log();
      console.log("===TEST storeRecipeData & getCategoryRecipes function===");
      //storeRecipeData Test: new category with two new recipe-------------
      storeRecipeData("cat1", [
        { title: "cat1_recipe1" },
        { title: "cat1_recipe2" },
      ]);
      console.log("new category with new recipe:");
      console.log(getCategoryRecipes()); //Object { cat1: (2) […] }

      //storeRecipeData Test: additional new category with one new recipes-------------
      storeRecipeData("cat2", [{ title: "cat2_recipe1" }]);
      console.log("additional new category with one new recipes:");
      console.log(getCategoryRecipes()); //Object { cat1: (2) […], cat2: (1) […] }

      //storeRecipeData Test: add new recipes to existed Category-------------
      storeRecipeData("cat1", [
        { title: "cat1_recipe3" },
        { title: "cat1_recipe4" },
        { title: "cat1_recipe5" },
      ]);
      storeRecipeData("cat2", [
        { title: "cat2_recipe2" },
        { title: "cat2_recipe3" },
      ]);
      console.log("add new recipes to existed Category:");
      console.log(getCategoryRecipes()); //Object { cat1: (5) […], cat2: (3) […] }

      //storeRecipeData duplicate Test: add existed recipes to existed Category-------------
      storeRecipeData("cat1", [
        { title: "cat1_recipe1" },
        { title: "cat1_recipe2" },
      ]);
      storeRecipeData("cat2", [{ title: "cat2_recipe1" }]);
      console.log("duplicate Test: add existed recipes to existed Category:");
      console.log(getCategoryRecipes()); //Object { cat1: (7) […], cat2: (4) […] } //duplicated
      //storeRecipeData duplicate mix Test: add existed & new recipes to existed Category-------------
      storeRecipeData("cat1", [
        { title: "cat1_recipe1" },
        { title: "cat1_recipe6" },
      ]);
      console.log(
        "duplicate mix Test: add existed & new recipes to existed Category:"
      );
      console.log(getCategoryRecipes()); //Object { cat1: (9) […], cat2: (4) […] } ////duplicated

      //===TEST saveRecipeToList & getSavedRecipes function=================================================================================
      localStorage.clear();
      console.log();
      console.log("===TEST storeRecipeData function===");
      //add non existing recipe to new list------------------
      saveRecipeToList("list1", "No_exist_recipe1");
      console.log("add non existing recipe to new list:");
      console.log(getSavedRecipes()); //Object { list1: (1) […] }

      //add more non existing recipe to new list------------------
      saveRecipeToList("list2", "No_exist_recipe1");
      console.log("add more non existing recipe to new list");
      console.log(getSavedRecipes()); //Object { list1: (1) […], list2: (1) […] }

      //add non existing recipe to existing list
      saveRecipeToList("list1", "No_exist_recipe2");
      saveRecipeToList("list2", "No_exist_recipe2");
      console.log("add non existing recipe to existing list");
      console.log(getSavedRecipes()); //Object { list1: (2) […], list2: (2) […] }

      //duplicate Test: add duplicate non existing recipe to existing list
      saveRecipeToList("list1", "No_exist_recipe1");
      saveRecipeToList("list2", "No_exist_recipe2");
      console.log(
        "duplicate Test: add duplicate non existing recipe to existing list"
      );
      console.log(getSavedRecipes()); //Object { list1: (2) […], list2: (2) […] } // dose NOT duplicate

      localStorage.clear();
      console.log("---localStorage.clear();---");
      storeRecipeData("cat1", [
        { title: "cat1_recipe1" },
        { title: "cat1_recipe2" },
        { title: "cat1_recipe3" },
      ]);
      storeRecipeData("cat2", [
        { title: "cat2_recipe1" },
        { title: "cat2_recipe2" },
      ]);

      //add existing recipe to new list------------------
      saveRecipeToList("list1", "cat1_recipe1");
      console.log("add existing recipe to new list");
      console.log(getSavedRecipes()); //Object { list1: (1) […] }

      //add more existing recipe to new list------------------
      saveRecipeToList("list2", "cat2_recipe1");
      console.log("add more existing recipe to new list");
      console.log(getSavedRecipes()); //Object { list1: (1) […], list2: (1) […] }

      //add non existing recipe to existing list
      saveRecipeToList("list1", "cat1_recipe2");
      saveRecipeToList("list2", "cat2_recipe2");
      console.log("add existing recipe to existing list");
      console.log(getSavedRecipes()); //Object { list1: (2) […], list2: (2) […] }

      //duplicate Test: add duplicate existing recipe to existing list
      saveRecipeToList("list1", "cat1_recipe1");
      saveRecipeToList("list2", "cat2_recipe1");
      console.log(
        "duplicate Test: add duplicate existing recipe to existing list"
      );
      console.log(getSavedRecipes()); //Object { list1: (2) […], list2: (2) […] } // dose NOT duplicate

      //===TEST createList & deleteList function======================================================
      localStorage.clear();
      console.log();
      console.log("===TEST createList & deleteList function===");

      //create empty saved recipe list
      createList("list1");
      createList("list2");
      createList("list3");
      console.log("create empty saved recipe list");
      console.log(getSavedRecipes()); //Object { listName: [], list2: [], list3: [] } //the first list has wrong name

      //add recipe to non exist list
      saveRecipeToList("list_4", "recipe1");
      console.log("add recipe to non exist list");
      console.log(getSavedRecipes()); //Object { listName: [], list2: [], list3: [], list_4: (1) […] }

      //add recipe to existing list
      saveRecipeToList("list2", "recipe1");
      saveRecipeToList("list3", "recipe1");
      console.log("add recipe to non exist list");
      console.log(getSavedRecipes()); //Object { listName: [], list2: (1) […], list3: (1) […], list_4: (1) […] }

      //duplicate test: create existing list
      createList("listName");
      createList("list2");
      createList("list3");
      createList("list_4");
      console.log("duplicate test: create existing list");
      console.log(getSavedRecipes()); //Object { listName: [], list2: (1) […], list3: (1) […], list_4: (1) […] }

      //delete existing list
      deleteList("list2");
      console.log("delete existing list");
      console.log(getSavedRecipes()); //Object { listName: [], list3: (1) […], list_4: (1) […] }

      //delete no exist list
      deleteList("list666");
      console.log("delete no exist list");
      console.log(getSavedRecipes()); //Object { listName: [], list3: (1) […], list_4: (1) […] }

      //delete all existing list
      deleteList("list3");
      deleteList("list_4");
      deleteList("listName");
      console.log("delete all existing list");
      console.log(getSavedRecipes()); //Object {  }

      //create List after delete all list
      createList("list 123");
      console.log("create List after delete all list");
      console.log(getSavedRecipes()); //Object { "list 123": [] }

      //===TEST removeRecipeFromList function======================================================
      localStorage.clear();
      console.log();
      console.log("===TEST removeRecipeFromList function===");

      //remove recipe from non exist recipe list
      removeRecipeFromList("list_non_exist", "recipe_non_exist");
      console.log("remove recipe from non exist recipe list");
      console.log(getSavedRecipes()); //null

      //init Recipe Data
      saveRecipeToList("cat1", "cat1_recipe1");
      saveRecipeToList("cat1", "cat1_recipe2");
      saveRecipeToList("cat1", "cat1_recipe3");
      saveRecipeToList("cat2", "cat2_recipe1");
      saveRecipeToList("cat2", "cat2_recipe2");
      //remove non exist recipe from existing list
      removeRecipeFromList("cat1", "cake");
      console.log("remove non exist recipe from existing list");
      console.log(getSavedRecipes()); //Object { cat1: (3) […], cat2: (2) […] }

      //remove existing recipes from existing list
      removeRecipeFromList("cat1", "cat1_recipe1");
      removeRecipeFromList("cat2", "cat2_recipe1");
      removeRecipeFromList("cat1", "cat1_recipe3");
      console.log("remove existing recipes from existing list");
      console.log(getSavedRecipes()); //Object { cat1: (1) […], cat2: (1) […] }

      //remove all existing recipes from existing list
      removeRecipeFromList("cat1", "cat1_recipe2");
      removeRecipeFromList("cat2", "cat2_recipe2");
      console.log("remove all existing recipes from existing list");
      console.log(getSavedRecipes()); //Object { cat1: [], cat2: [] }

      //add recipe after all recipes removed
      saveRecipeToList("cat1", "cat1_recipe1");
      saveRecipeToList("cat1", "cat1_recipe2");
      saveRecipeToList("cat2", "cat2_recipe1");
      saveRecipeToList("cat2", "cat2_recipe2");
      console.log("add recipe after all recipes removed");
      console.log(getSavedRecipes()); //Object { cat1: (2) […], cat2: (2) […] }

      //===TEST getRecipe function======================================================
      localStorage.clear();
      console.log();
      console.log("===TEST getRecipe function===");
      //init data
      storeRecipeData("cat1", [
        { title: "cat1_recipe1" },
        { title: "cat1_recipe2" },
        { title: "cat1_recipe3" },
      ]);
      storeRecipeData("cat2", [
        { title: "cat2_recipe1" },
        { title: "cat2_recipe2" },
      ]);

      //get existed recipe
      console.log("get existed recipe");
      console.log(getRecipe("cat1_recipe1")); //Object { title: "cat1_recipe1" }
      console.log(getRecipe("cat1_recipe3")); //Object { title: "cat1_recipe3" }
      console.log(getRecipe("cat2_recipe1")); //Object { title: "cat2_recipe1" }
      console.log(getRecipe("cat2_recipe2")); //Object { title: "cat2_recipe2" }

      //get non exist recipe
      console.log("get non exist recipe");
      console.log(getRecipe("cat1_recipe999")); //null
      console.log(getRecipe("cat1_recipe666")); //null

      localStorage.clear();
      console.log();
      console.log("localStorage.clear();");
      console.log("getRecip() duplicate test");
      storeRecipeData("cat1", [
        { title: "cat1_recipe1" },
        { title: "cat1_recipe2" },
        { title: "cat1_recipe1" },
      ]);
      console.log(" a category that have duplicate(same title name) Recipes");
      console.log(getCategoryRecipes());
      console.log(
        "get recipe from a category that have duplicate(same title name) Recipes"
      );
      console.log(getRecipe("cat1_recipe1")); //Object { title: "cat1_recipe1" }

      //original test case
      // storeRecipeData("test", [
      //   { title: "testrecipe1" },
      //   { title: "testrecipe2" },
      // ]);
      // storeRecipeData("test2", [
      //   { title: "testrecipe3" },
      //   { title: "testrecipe4" },
      // ]);
      // saveRecipeToList("list1", "testrecipe1");
      // saveRecipeToList("list2", "testrecipe4");
      // createList('list4')

      // console.log(getCategoryRecipes());
      // console.log(getSavedRecipes());
      // console.log(getRecipe('testrecipe4'));
    </script>
  </body>
</html>
